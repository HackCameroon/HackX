{% extends "admin.html" %}

{% block title %}Admin - QR Settings{% endblock %}

{% block css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/table.css') }}">
{% endblock %}

{% block js %}

{% endblock %}
{% block subtitle %}QR Settings{% endblock %}
{% block addContent %}
    <br/>
    <button type="button" class="btn btn-primary" id="generateNametags">Generate Nametags</button>
    <br/>
    <br/>

    <div class="alert alert-success" role="alert" id="updateMsg" style="display:none;">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      Successfully updated record!
    </div>

    <table id="dtBasicExample" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
  <thead>
    <tr>
      <th class="th-sm"><center>Name</center></th>
      <th class="th-sm"><center>Checked In</center></th>
      <th class="th-sm"><center>Saturday Breakfast</center></th>
      <th class="th-sm"><center>Saturday Lunch</center></th>
      <th class="th-sm"><center>Saturday Dinner</center></th>
      <th class="th-sm"><center>Sunday Breakfast</center></th>
      <th class="th-sm"><center>Sunday Lunch</center></th>
    </tr>
  </thead>
  <tbody>
        {% for u in all_hackers %}
            {% if u.confirmation[0].confirmed %}
                <tr>
                  <td><center>{{ u.application[0].full_name }}</center></td>
                  <td><center><input type="checkbox" id="{{ u.qr_hash }}-check-in" onclick="updateInput('{{ u.qr_hash }}', 'check-in')" {% if u.checked_in %}checked{% endif %}></center></td>
                  <td><center><input type="checkbox" id="{{ u.qr_hash }}-sat-breakfast" onclick="updateInput('{{ u.qr_hash }}', 'sat-breakfast')" {% if u.sat_breakfast %}checked{% endif %}></center></td>
                  <td><center><input type="checkbox" id="{{ u.qr_hash }}-sat-lunch" onclick="updateInput('{{ u.qr_hash }}', 'sat-lunch')" {% if u.sat_lunch %}checked{% endif %}></center></td>
                  <td><center><input type="checkbox" id="{{ u.qr_hash }}-sat-dinner" onclick="updateInput('{{ u.qr_hash }}', 'sat-dinner')" {% if u.sat_dinner %}checked{% endif %}></center></td>
                  <td><center><input type="checkbox" id="{{ u.qr_hash }}-sun-breakfast" onclick="updateInput('{{ u.qr_hash }}', 'sun-breakfast')" {% if u.sun_breakfast %}checked{% endif %}></center></td>
                  <td><center><input type="checkbox" id="{{ u.qr_hash }}-sun-lunch" onclick="updateInput('{{ u.qr_hash }}', 'sun-lunch')" {% if u.sun_lunch %}checked{% endif %}></center></td>
                </tr>
            {% endif %}
        {% endfor %}
  </tbody>
</table>


<script>
    $('#generateNametags').click(function(e) {
        e.preventDefault();  //stop the browser from following
        window.location.href = window.location.origin + "/admin/nametags";
    });
    $(document).ready(function() {
        $('#dtBasicExample').dataTable({
            "order": [[ 0, "desc" ]],
            "pageLength": 1000,
        });
    });
    function updateInput(qr, typ){
        var id = qr + '-' + typ;
        console.log(id);
        if (document.getElementById(id).checked == true){
            tf = "true";
        }
        else{
            tf = "false";
        }
        var url = "/admin/qr/update/" + typ + "/" + qr + "/" + tf;
        console.log(url);
        $.get( "/admin/qr/update/" + typ + "/" + qr + "/" + tf, function( data, textStatus, xhr ) {
            console.log(data);
            if (data.approved == true){
                console.log("DONE!");
                document.getElementById('updateMsg').style.display = "";
                setTimeout(function(){
                    document.getElementById('updateMsg').style.display = "none";
                }, 2500);
            }
        });
    }
</script>

{% endblock %}
